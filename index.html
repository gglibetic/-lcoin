<!DOCTYPE html>
<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<head>
<style type='text/css'>
* {
  font-family: sans;
}

input {
  border: 1px solid blue;
  border-radius: 4px;
}

td {
  height: 2em
}

#holder {
  margin: 0 auto;
  width: 22em;
}

table {
  width: 100%;
  margin: 0 auto;
}

#cnhold {
  width: 4em;
  margin:0 auto;
}

#check {
  width: 10em;
  height: 4em;
  margin:0 auto;
  padding: 0
}

button {
  height: 100%;
  width: 100%;
  background-color: #00FFEF;
  color: black;
  border-radius: 2em
}
      
</style>
</head>
<body>

<div id='cnhold' onclick='spendCoins()' >
  <img style='height:30px' src='coin.jpg'/>
  <span id='cn' style='font-size: 1.5em'></span>
</div>
<br/>
<div id='holder'>
  <table id='x'></table>
  <div id='check'>
    <button onclick='checkAnswers()'>Submit</button>
  </div>
</div>

<script type='text/javascript'>

function generateNumber1To10() {
  return Math.floor((Math.random() * 10) + 1);
}

function generateOneQAndAMul() {
  x = generateNumber1To10();
  y = generateNumber1To10();
  return {
    'problemArr': [x, '&times;', y, "&equals;"],
    'result': x * y
  };
}

function generateOneQAndADiv() {
  x = generateNumber1To10();
  y = generateNumber1To10();
  return {
    'problemArr': [x * y, '&divide;', y, "&equals;"],
    'result': x 
  };
}

let generateOneQAndA = (Math.random() > 0.5) ? 
                         generateOneQAndAMul :
                         generateOneQAndADiv;

function generateQAndAs() {
  return [...Array(10).keys()].map(generateOneQAndA);
}

function printOneRow(record) {
  let inner = record.problemArr.map( el => "<td>"+el+"</td>").join('');
  return "<tr>" + inner + "<td style='width:50%'><input type='number'/></td></tr>";
}

let tokenGiven = false;

function checkAnswers() {
  let table = document.getElementById('x');
  let allGood = true;
  for (var i=0, row; row = table.rows[i]; i++) {
    if (row.cells[4].firstChild.value == qanda[i].result) {
      row.cells[4].firstChild.style = 'color:white;background-color:green';
    } else {
      allGood = false;
      row.cells[4].firstChild.style = 'color:white;background-color:red';
    }
  }
  if (allGood && !tokenGiven) {
    tokenGiven = true;
    localStorage.coins = Number(localStorage.coins) + 1;
    redrawCoins();
  }
}

function spendCoins() {
  let toSpend = Number(prompt("How much to spend?"));
  if (isNaN(toSpend)) {
    alert("Not a number!");
    return;
  }
  if (toSpend < 0) {
    alert("Negative number");
    return;
  }
  if (toSpend > Number(localStorage.coins)) {
    alert("Not that much money");
    return;
  } 
  localStorage.coins = Number(localStorage.coins) - toSpend;
  redrawCoins();
}

function redrawCoins() {
  document.getElementById('cn').innerHTML = localStorage.coins;
}
let qanda = generateQAndAs();
document.getElementById('x').innerHTML = qanda.map(printOneRow).join('');
if (localStorage.coins == undefined) {
  localStorage.coins = 0;
}
redrawCoins();

</script>
</body>
</html>
